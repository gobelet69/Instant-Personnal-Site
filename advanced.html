<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>14KB Core</title>
<style>
    :root { --bg: #050505; --p: #0f0; --s: #00f; --t: #f0f; --txt: #cecece; --font: 'Courier New', monospace; }
    body { background: var(--bg); color: var(--txt); font-family: var(--font); margin: 0; overflow: hidden; height: 100vh; display: grid; grid-template-rows: 60px 1fr 30px; }
    
    /* HEADER */
    header { display: flex; justify-content: space-between; align-items: center; padding: 0 20px; border-bottom: 1px solid #333; background: #111; z-index: 10; }
    h1 { font-size: 1.2rem; margin: 0; letter-spacing: 2px; }
    .status { font-size: 0.8rem; color: var(--p); animation: blink 2s infinite; }
    
    /* NAV */
    .nav { display: flex; gap: 5px; }
    button { background: #222; border: 1px solid #444; color: #fff; padding: 5px 15px; cursor: pointer; font-family: inherit; transition: 0.2s; font-size: 0.8rem; }
    button:hover, button.active { background: var(--p); color: #000; border-color: var(--p); box-shadow: 0 0 10px var(--p); }

    /* MAIN STAGE */
    main { position: relative; width: 100%; height: 100%; overflow: hidden; }
    .view { position: absolute; top:0; left:0; width:100%; height:100%; display:none; flex-direction: column; align-items: center; justify-content: center; }
    .view.active { display: flex; }
    
    canvas { background: radial-gradient(circle at center, #1a1a1a 0%, #000 100%); border: 1px solid #333; box-shadow: 0 0 30px rgba(0,0,0,0.5); image-rendering: pixelated; max-width: 95%; max-height: 90vh; }
    
    /* TERMINAL SPECIFIC */
    #term-view { align-items: stretch; padding: 20px; background: #000; font-family: monospace; }
    #term-out { flex: 1; overflow-y: auto; color: #bbb; margin-bottom: 10px; white-space: pre-wrap; }
    #term-in-wrap { display: flex; border-top: 1px solid #333; padding-top: 10px; }
    #term-in { background: transparent; border: none; color: var(--p); flex: 1; outline: none; font-family: inherit; font-size: 1rem; }
    .sys-msg { color: #555; font-style: italic; }
    .res-ok { color: var(--p); } .res-err { color: #f00; }

    /* CONTROLS OVERLAY */
    .overlay { position: absolute; bottom: 20px; left: 50%; transform: translateX(-50%); background: rgba(0,0,0,0.8); padding: 10px; border-radius: 4px; border: 1px solid #444; pointer-events: none; text-align: center; }
    kbd { background: #333; padding: 2px 5px; border-radius: 3px; border: 1px solid #555; font-size: 0.9em; }

    footer { background: #111; border-top: 1px solid #333; display: flex; justify-content: space-between; padding: 0 10px; align-items: center; font-size: 0.75rem; color: #666; }
    
    @keyframes blink { 50% { opacity: 0.5; } }
</style>
</head>
<body>

<header>
    <div>
        <h1>CORE.14KB</h1>
    </div>
    <div class="nav">
        <button onclick="App.switch('cube')" class="active">3D ENGINE</button>
        <button onclick="App.switch('audio')">SYNTH</button>
        <button onclick="App.switch('swarm')">PHYSICS</button>
        <button onclick="App.switch('term')">CONSOLE</button>
    </div>
</header>

<main>
    <div id="cube" class="view active">
        <canvas id="c3d"></canvas>
        <div class="overlay">Drag to Rotate • Scroll to Zoom</div>
    </div>

    <div id="audio" class="view">
        <canvas id="cAud"></canvas>
        <div class="overlay">Press <kbd>A</kbd> <kbd>S</kbd> <kbd>D</kbd> <kbd>F</kbd> <kbd>G</kbd> to Play</div>
    </div>

    <div id="swarm" class="view">
        <canvas id="cSwarm"></canvas>
        <div class="overlay">Move Mouse to Repel • Click to Attract</div>
    </div>

    <div id="term" class="view" style="justify-content: stretch;">
        <div id="term-view">
            <div id="term-out">
                <div>Welcome to SYSTEM CORE.</div>
                <div class="sys-msg">Memory: 14KB OK.</div>
                <div class="sys-msg">GPU: Software Emulation OK.</div>
                <br>
                <div>Type 'help' to list commands.</div>
            </div>
            <div id="term-in-wrap">
                <span style="color:var(--p); margin-right:10px;">root@14kb:~#</span>
                <input type="text" id="term-in" autocomplete="off" spellcheck="false" autofocus>
            </div>
        </div>
    </div>
</main>

<footer>
    <span>TCP IW10 OPTIMIZED</span>
    <span class="status">● SYSTEM ACTIVE</span>
</footer>

<script>
/**
 * THE CORE ENGINE
 * Contains: 3D Math, Audio Context, Particle Physics, Command Parser
 */

const $ = i => document.getElementById(i);
const R = (m,x) => Math.random()*(x-m)+m;

const App = {
    mode: 'cube',
    w: 0, h: 0,
    init() {
        this.resize();
        window.onresize = () => this.resize();
        this.loop();
        
        // Input handling
        $('term-in').addEventListener('keydown', e => {
            if(e.key === 'Enter') Term.exec(e.target.value);
        });
        
        window.addEventListener('keydown', e => Synth.play(e.key));
        
        // Mouse for 3D and Swarm
        window.addEventListener('mousemove', e => {
            Swarm.mx = e.clientX; Swarm.my = e.clientY - 60; // offset header
            if(e.buttons === 1 && this.mode === 'cube') {
                Cube.rot.y += e.movementX * 0.01;
                Cube.rot.x += e.movementY * 0.01;
            }
        });
        window.addEventListener('mousedown', () => Swarm.repel = false);
        window.addEventListener('mouseup', () => Swarm.repel = true);
        window.addEventListener('wheel', e => Cube.z += e.deltaY * 0.1);
    },
    switch(m) {
        document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
        document.querySelectorAll('button').forEach(b => b.classList.remove('active'));
        $(m).classList.add('active');
        // Find button that triggered this
        const btn = Array.from(document.querySelectorAll('button')).find(b => b.getAttribute('onclick').includes(m));
        if(btn) btn.classList.add('active');
        
        this.mode = m;
        if(m==='term') $('term-in').focus();
        this.resize();
    },
    resize() {
        const b = document.querySelector('main').getBoundingClientRect();
        this.w = b.width; this.h = b.height;
        ['c3d', 'cAud', 'cSwarm'].forEach(id => {
            const c = $(id); c.width = this.w; c.height = this.h;
        });
        Cube.init(); Swarm.init();
    },
    loop() {
        requestAnimationFrame(() => this.loop());
        if(this.mode === 'cube') Cube.render();
        if(this.mode === 'audio') Synth.vis();
        if(this.mode === 'swarm') Swarm.render();
    }
};

// --- MODULE 1: 3D WIREFRAME ENGINE (No Libraries) ---
const Cube = {
    v: [], e: [], rot: {x:0.5, y:0.5}, z: 500,
    ctx: $('c3d').getContext('2d'),
    init() {
        // Create Icosahedron vertices roughly
        const t = (1 + Math.sqrt(5)) / 2 * 50;
        const v = [[-50,t,0],[50,t,0],[-50,-t,0],[50,-t,0],[0,-50,t],[0,50,t],[0,-50,-t],[0,50,-t],[t,0,-50],[t,0,50],[-t,0,-50],[-t,0,50]];
        this.v = v.map(p => ({x:p[0], y:p[1], z:p[2]}));
        // Connect all close vertices
        this.e = [];
        for(let i=0; i<this.v.length; i++) {
            for(let j=i+1; j<this.v.length; j++) {
                const d = Math.hypot(this.v[i].x-this.v[j].x, this.v[i].y-this.v[j].y, this.v[i].z-this.v[j].z);
                if(d < 120) this.e.push([i, j]);
            }
        }
    },
    project(x,y,z) {
        // 3D Rotation Math
        let x1 = x*Math.cos(this.rot.y) - z*Math.sin(this.rot.y);
        let z1 = z*Math.cos(this.rot.y) + x*Math.sin(this.rot.y);
        let y1 = y*Math.cos(this.rot.x) - z1*Math.sin(this.rot.x);
        let z2 = z1*Math.cos(this.rot.x) + y*Math.sin(this.rot.x);
        
        // Perspective Projection
        const f = 400 / (z2 + this.z);
        return { x: x1*f + App.w/2, y: y1*f + App.h/2 };
    },
    render() {
        const c = this.ctx;
        c.fillStyle = '#000'; c.fillRect(0,0,App.w,App.h);
        
        // Auto rotate
        this.rot.y += 0.005; 
        
        c.beginPath();
        c.strokeStyle = '#0f0';
        this.e.forEach(edge => {
            const p1 = this.project(this.v[edge[0]].x, this.v[edge[0]].y, this.v[edge[0]].z);
            const p2 = this.project(this.v[edge[1]].x, this.v[edge[1]].y, this.v[edge[1]].z);
            c.moveTo(p1.x, p1.y); c.lineTo(p2.x, p2.y);
        });
        c.stroke();
        
        // Nodes
        c.fillStyle = '#fff';
        this.v.forEach(v => {
            const p = this.project(v.x, v.y, v.z);
            c.fillRect(p.x-2, p.y-2, 4, 4);
        });
    }
};

// --- MODULE 2: AUDIO SYNTH & VISUALIZER ---
const Synth = {
    ctx: null, an: null, 
    keys: {'a':261.6,'s':293.6,'d':329.6,'f':349.2,'g':392.0,'h':440.0,'j':493.8},
    setup() {
        if(this.ctx) return;
        this.ctx = new (window.AudioContext || window.webkitAudioContext)();
        this.an = this.ctx.createAnalyser();
        this.an.connect(this.ctx.destination);
    },
    play(k) {
        if(!this.keys[k]) return;
        this.setup();
        const o = this.ctx.createOscillator();
        const g = this.ctx.createGain();
        o.type = 'sawtooth';
        o.frequency.value = this.keys[k];
        o.connect(g); g.connect(this.an);
        o.start();
        g.gain.exponentialRampToValueAtTime(0.0001, this.ctx.currentTime + 0.5);
        o.stop(this.ctx.currentTime + 0.5);
    },
    vis() {
        const c = $('cAud').getContext('2d');
        c.fillStyle = 'rgba(0,0,0,0.2)'; c.fillRect(0,0,App.w,App.h); // Trail effect
        if(!this.an) return;
        
        const arr = new Uint8Array(this.an.frequencyBinCount);
        this.an.getByteTimeDomainData(arr);
        
        c.lineWidth = 2; c.strokeStyle = '#0ff'; c.beginPath();
        const slice = App.w * 1.0 / arr.length;
        let x = 0;
        for(let i=0; i<arr.length; i++) {
            const v = arr[i] / 128.0;
            const y = v * App.h/2;
            if(i===0) c.moveTo(x,y); else c.lineTo(x,y);
            x += slice;
        }
        c.stroke();
    }
};

// --- MODULE 3: PHYSICS SWARM ---
const Swarm = {
    p: [], mx: -100, my: -100, repel: true,
    init() {
        this.p = [];
        for(let i=0; i<200; i++) this.p.push({x:R(0,App.w), y:R(0,App.h), vx:R(-2,2), vy:R(-2,2)});
    },
    render() {
        const c = $('cSwarm').getContext('2d');
        c.clearRect(0,0,App.w,App.h);
        c.fillStyle = this.repel ? '#f0f' : '#0ff';
        
        this.p.forEach(p => {
            // Physics
            p.x += p.vx; p.y += p.vy;
            
            // Mouse Interaction
            const dx = p.x - this.mx, dy = p.y - this.my;
            const dist = Math.hypot(dx, dy);
            if(dist < 150) {
                const f = this.repel ? 50/dist : -50/dist;
                p.vx += (dx/dist)*f; p.vy += (dy/dist)*f;
            }
            
            // Friction & Bounds
            p.vx *= 0.95; p.vy *= 0.95;
            if(p.x<0) p.x=App.w; if(p.x>App.w) p.x=0;
            if(p.y<0) p.y=App.h; if(p.y>App.h) p.y=0;
            
            c.fillRect(p.x, p.y, 2, 2);
        });
        
        // Draw Mouse Cursor halo
        c.strokeStyle = '#333'; c.beginPath(); c.arc(this.mx, this.my, 20, 0, 6.28); c.stroke();
    }
};

// --- MODULE 4: TERMINAL ---
const Term = {
    out: $('term-out'),
    in: $('term-in'),
    fs: { 'readme.txt': 'Build interactive systems.', 'secret.dat': '0x4421' },
    log(txt, cls='') {
        const d = document.createElement('div');
        d.textContent = txt; d.className = cls;
        this.out.appendChild(d);
        this.out.scrollTop = this.out.scrollHeight;
    },
    exec(cmd) {
        cmd = cmd.trim();
        this.log(`root@14kb:~# ${cmd}`, 'sys-msg');
        this.in.value = '';
        
        const args = cmd.split(' ');
        const c = args[0].toLowerCase();
        
        switch(c) {
            case 'help': this.log('CMDS: help, clear, ls, cat [file], date, matrix, reboot'); break;
            case 'clear': this.out.innerHTML = ''; break;
            case 'date': this.log(new Date().toString(), 'res-ok'); break;
            case 'ls': this.log(Object.keys(this.fs).join('  '), 'res-ok'); break;
            case 'cat': 
                if(this.fs[args[1]]) this.log(this.fs[args[1]], 'res-ok'); 
                else this.log('File not found', 'res-err');
                break;
            case 'reboot': location.reload(); break;
            case 'matrix':
                this.log('Wake up, Neo...', 'res-ok');
                setTimeout(()=>this.log('The Matrix has you...'), 1000);
                setTimeout(()=>this.log('Follow the white rabbit.'), 2000);
                break;
            default: this.log(`bash: ${c}: command not found`, 'res-err');
        }
    }
};

// BOOT
App.init();

</script>
</body>
</html>